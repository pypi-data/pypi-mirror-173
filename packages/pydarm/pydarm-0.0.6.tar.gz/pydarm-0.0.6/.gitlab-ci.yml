# This file is a modified template for the continuous integration of pyDARM with
# GitLab. The template was utilized from
# https://git.ligo.org/lscsoft/example-ci-project/blob/python/.gitlab-ci.yml

stages:
    - test

python3:
  image: igwn/base:conda
  stage: test
  script:
    - . /opt/conda/etc/profile.d/conda.sh
    - conda env create -n pydarm-test -f conda/environment.yaml
    - conda activate pydarm-test

    # Run pyflakes
    - flake8 .

    # Run tests here
    - python3 -m coverage run -m unittest discover

    # Basic CLI test
    - python3 -m coverage run --append -m pydarm --help
    - python3 -m coverage run --append -m pydarm fr --help

    # report coverage
    - python3 -m coverage report
    - python3 -m coverage xml -o coverage.xml
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage.xml
  coverage: '/^TOTAL\s+.*\s+(\d+\.?\d*)%/'
